<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ之DefaultPullConsumer | itcompare</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo/small.png">
    <meta name="description" content="本站致力于对it中相关技术进行比较，解决从业人员技术选型中的类比的问题！">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.a67bd29c.css" as="style"><link rel="preload" href="/assets/js/app.9c8caac1.js" as="script"><link rel="preload" href="/assets/js/4.842ec080.js" as="script"><link rel="preload" href="/assets/js/1.792b16dc.js" as="script"><link rel="preload" href="/assets/js/34.11e107ed.js" as="script"><link rel="prefetch" href="/assets/js/10.55d7ff9d.js"><link rel="prefetch" href="/assets/js/11.8216091f.js"><link rel="prefetch" href="/assets/js/12.07457c10.js"><link rel="prefetch" href="/assets/js/13.ec4d8e8f.js"><link rel="prefetch" href="/assets/js/14.5c0ecd9f.js"><link rel="prefetch" href="/assets/js/15.ca0b40b1.js"><link rel="prefetch" href="/assets/js/16.e2d13d52.js"><link rel="prefetch" href="/assets/js/17.2b8bd84c.js"><link rel="prefetch" href="/assets/js/18.98247586.js"><link rel="prefetch" href="/assets/js/19.9003d6e0.js"><link rel="prefetch" href="/assets/js/2.903f4fa2.js"><link rel="prefetch" href="/assets/js/20.3b90250d.js"><link rel="prefetch" href="/assets/js/21.cff53a55.js"><link rel="prefetch" href="/assets/js/22.6ce4fad0.js"><link rel="prefetch" href="/assets/js/23.75d155e5.js"><link rel="prefetch" href="/assets/js/24.70aa1837.js"><link rel="prefetch" href="/assets/js/25.44c66219.js"><link rel="prefetch" href="/assets/js/26.231ef3a1.js"><link rel="prefetch" href="/assets/js/27.b0dd039f.js"><link rel="prefetch" href="/assets/js/28.98633deb.js"><link rel="prefetch" href="/assets/js/29.f9bb9920.js"><link rel="prefetch" href="/assets/js/30.51bf15b8.js"><link rel="prefetch" href="/assets/js/31.3914b65b.js"><link rel="prefetch" href="/assets/js/32.b8954921.js"><link rel="prefetch" href="/assets/js/33.5c65ecc7.js"><link rel="prefetch" href="/assets/js/35.a10dd1a8.js"><link rel="prefetch" href="/assets/js/36.526cda4a.js"><link rel="prefetch" href="/assets/js/37.86387221.js"><link rel="prefetch" href="/assets/js/38.50f19e3d.js"><link rel="prefetch" href="/assets/js/39.2bea2565.js"><link rel="prefetch" href="/assets/js/40.04748614.js"><link rel="prefetch" href="/assets/js/41.b8c56b92.js"><link rel="prefetch" href="/assets/js/42.af1f7aea.js"><link rel="prefetch" href="/assets/js/43.bb913c5a.js"><link rel="prefetch" href="/assets/js/44.cb7c4e40.js"><link rel="prefetch" href="/assets/js/45.477cb7d4.js"><link rel="prefetch" href="/assets/js/46.acaba2ab.js"><link rel="prefetch" href="/assets/js/47.513af7e7.js"><link rel="prefetch" href="/assets/js/5.121dd7d9.js"><link rel="prefetch" href="/assets/js/6.1370a3d8.js"><link rel="prefetch" href="/assets/js/7.689f420d.js"><link rel="prefetch" href="/assets/js/8.9830c84b.js"><link rel="prefetch" href="/assets/js/9.fe588154.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a67bd29c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-58dedfb1><div data-v-58dedfb1><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-58dedfb1 data-v-58dedfb1><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-9b04387a data-v-58dedfb1 data-v-58dedfb1><h3 class="title" data-v-9b04387a data-v-9b04387a>itcompare</h3> <p class="description" data-v-9b04387a data-v-9b04387a>本站致力于对it中相关技术进行比较，解决从业人员技术选型中的类比的问题！</p> <label id="box" class="inputBox" data-v-9b04387a data-v-9b04387a><input type="password" value="" data-v-9b04387a> <span data-v-9b04387a>Konck! Knock!</span> <button data-v-9b04387a>OK</button></label> <div class="footer" data-v-9b04387a data-v-9b04387a><span data-v-9b04387a><i class="iconfont reco-theme" data-v-9b04387a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-9b04387a>vuePress-theme-reco</a></span> <span data-v-9b04387a><i class="iconfont reco-copyright" data-v-9b04387a></i> <a data-v-9b04387a><span data-v-9b04387a>fanghuabao</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-58dedfb1><header class="navbar" data-v-58dedfb1><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo/small.png" alt="itcompare" class="logo"> <span class="site-name">itcompare</span></a> <div class="links"><!----> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/introduce/index.html" class="nav-link"><i class="undefined"></i>
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息中间件/" class="nav-link"><i class="undefined"></i>
  消息中间件
</a></li><li class="dropdown-item"><!----> <a href="/categories/指南/" class="nav-link"><i class="undefined"></i>
  指南
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="undefined"></i>
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-58dedfb1></div> <aside class="sidebar" data-v-58dedfb1><div class="personal-info-wrapper" data-v-5d033c14 data-v-58dedfb1><!----> <h3 class="name" data-v-5d033c14>
    fanghuabao
  </h3> <div class="num" data-v-5d033c14><div data-v-5d033c14><h3 data-v-5d033c14>36</h3> <h6 data-v-5d033c14>Articles</h6></div> <div data-v-5d033c14><h3 data-v-5d033c14>9</h3> <h6 data-v-5d033c14>Tags</h6></div></div> <ul class="social-links" data-v-5d033c14></ul> <hr data-v-5d033c14></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/introduce/index.html" class="nav-link"><i class="undefined"></i>
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息中间件/" class="nav-link"><i class="undefined"></i>
  消息中间件
</a></li><li class="dropdown-item"><!----> <a href="/categories/指南/" class="nav-link"><i class="undefined"></i>
  指南
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="undefined"></i>
  时间线
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-9b04387a data-v-58dedfb1><h3 class="title" data-v-9b04387a data-v-9b04387a>RocketMQ之DefaultPullConsumer</h3> <!----> <label id="box" class="inputBox" data-v-9b04387a data-v-9b04387a><input type="password" value="" data-v-9b04387a> <span data-v-9b04387a>Konck! Knock!</span> <button data-v-9b04387a>OK</button></label> <div class="footer" data-v-9b04387a data-v-9b04387a><span data-v-9b04387a><i class="iconfont reco-theme" data-v-9b04387a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-9b04387a>vuePress-theme-reco</a></span> <span data-v-9b04387a><i class="iconfont reco-copyright" data-v-9b04387a></i> <a data-v-9b04387a><span data-v-9b04387a>fanghuabao</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-58dedfb1><main class="page"><section><div class="page-title"><h1 class="title">RocketMQ之DefaultPullConsumer</h1> <div data-v-618f81d2><i class="iconfont reco-account" data-v-618f81d2><span data-v-618f81d2>fanghuabao</span></i> <i class="iconfont reco-date" data-v-618f81d2><span data-v-618f81d2>8/15/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-618f81d2><span class="tag-item" data-v-618f81d2>RocketMQ</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="类简介"><a href="#类简介" class="header-anchor">#</a> 类简介</h2> <ol><li><p><code>DefaultMQPullConsumer extends ClientConfig implements MQPullConsumer</code></p></li> <li><p><code>DefaultMQPullConsumer</code>主动的从Broker拉取消息，主动权由应用控制，可以实现批量的消费消息。Pull方式取消息的过程需要用户自己写,首先通过打算消费的Topic拿到MessageQueue的集合,遍历MessageQueue集合,然后针对每个MessageQueue批量取消息,也可以自定义与控制offset位置。</p></li> <li><p>优势:consumer可以按需消费,不用担心自己处理能力,而broker堆积消息也会相对简单,无需记录每一个要发送消息的状态,只需要维护所有消息的队列和偏移量就可以了。所以对于慢消费,消息量有限且到来的速度不均匀的情况,pull模式比较合适消息延迟与忙等。</p></li> <li><p>缺点:由于主动权在消费方,消费方无法及时获取最新的消息。比较适合不及时批处理场景。</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPullConsumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">PullResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageQueue</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQPullConsumer</span> <span class="token punctuation">{</span>
 
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> OFFSE_TABLE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
		<span class="token class-name">DefaultMQPullConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPullConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;groupName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 从指定topic中拉取所有消息队列</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">fetchSubscribeMessageQueues</span><span class="token punctuation">(</span><span class="token string">&quot;order-topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> mq<span class="token operator">:</span>mqs<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token comment">// 获取消息的offset，指定从store中获取</span>
				<span class="token keyword">long</span> offset <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">fetchConsumeOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumer from the queue:&quot;</span><span class="token operator">+</span>mq<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token class-name">PullResult</span> pullResult <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">pullBlockIfNotFound</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> 
							<span class="token function">getMessageQueueOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">putMessageQueueOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span>pullResult<span class="token punctuation">.</span><span class="token function">getNextBeginOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">switch</span><span class="token punctuation">(</span>pullResult<span class="token punctuation">.</span><span class="token function">getPullStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">case</span> FOUND<span class="token operator">:</span>
						<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messageExtList <span class="token operator">=</span> pullResult<span class="token punctuation">.</span><span class="token function">getMsgFoundList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> m <span class="token operator">:</span> messageExtList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> NO_MATCHED_MSG<span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> NO_NEW_MSG<span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> OFFSET_ILLEGAL<span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		consumer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token comment">// 保存上次消费的消息下标</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">putMessageQueueOffset</span><span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> mq<span class="token punctuation">,</span>
			<span class="token keyword">long</span> nextBeginOffset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		OFFSE_TABLE<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> nextBeginOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 获取上次消费的消息的下标</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Long</span> <span class="token function">getMessageQueueOffset</span><span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> mq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Long</span> offset <span class="token operator">=</span> OFFSE_TABLE<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mq<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>offset <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> offset<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token number">0l</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
 
<span class="token punctuation">}</span>
</code></pre></div><h2 id="字段摘要"><a href="#字段摘要" class="header-anchor">#</a> 字段摘要</h2> <table><thead><tr><th>类型</th> <th>字段名称</th> <th>描述</th></tr></thead> <tbody><tr><td>DefaultMQPullConsumerImpl</td> <td>defaultMQPullConsumerImpl</td> <td>DefaultMQPullConsumer的内部核心处理默认实现</td></tr> <tr><td>String</td> <td>consumerGroup</td> <td>消费的唯一分组</td></tr> <tr><td>long</td> <td>brokerSuspendMaxTimeMillis</td> <td>consumer取连接broker的最大延迟时间，不建议修改</td></tr> <tr><td>long</td> <td>consumerTimeoutMillisWhenSuspend</td> <td>pull取连接的最大超时时间，必须大于brokerSuspendMaxTimeMillis，不建议修改</td></tr> <tr><td>long</td> <td>consumerPullTimeoutMillis</td> <td>socket连接的最大超时时间，不建议修改</td></tr> <tr><td>String</td> <td>messageModel</td> <td>默认cluster模式</td></tr> <tr><td>int</td> <td>messageQueueListener</td> <td>消息queue监听器，用来获取topic的queue变化</td></tr> <tr><td>int</td> <td>offsetStore</td> <td>RemoteBrokerOffsetStore 远程与本地offset存储器</td></tr> <tr><td>int</td> <td>registerTopics</td> <td>注册到该consumer的topic集合</td></tr> <tr><td>int</td> <td>allocateMessageQueueStrategy</td> <td>consumer的默认获取queue的负载分配策略算法</td></tr></tbody></table> <h2 id="构造方法摘要"><a href="#构造方法摘要" class="header-anchor">#</a> 构造方法摘要</h2> <table><thead><tr><th>方法名称</th> <th>方法描述</th></tr></thead> <tbody><tr><td>DefaultMQPullConsumer()</td> <td>由默认参数值创建一个Pull消费者</td></tr> <tr><td>DefaultMQPullConsumer(final String consumerGroup, RPCHook rpcHook)</td> <td>使用指定的分组名，hook创建一个消费者</td></tr> <tr><td>DefaultMQPullConsumer(final String consumerGroup)</td> <td>使用指定的分组名消费者</td></tr> <tr><td>DefaultMQPullConsumer(RPCHook rpcHook)</td> <td>使用指定的hook创建一个生产者</td></tr></tbody></table> <h2 id="使用方法摘要"><a href="#使用方法摘要" class="header-anchor">#</a> 使用方法摘要</h2> <table><thead><tr><th>返回值</th> <th>方法名称</th> <th>方法描述</th></tr></thead> <tbody><tr><td>MQAdmin接口method</td> <td>-------</td> <td>------------</td></tr> <tr><td>void</td> <td>createTopic(String key, String newTopic, int queueNum)</td> <td>在broker上创建指定的topic</td></tr> <tr><td>void</td> <td>createTopic(String key, String newTopic, int queueNum, int topicSysFlag)</td> <td>在broker上创建指定的topic</td></tr> <tr><td>long</td> <td>earliestMsgStoreTime(MessageQueue mq)</td> <td>查询最早的消息存储时间</td></tr> <tr><td>long</td> <td>maxOffset(MessageQueue mq)</td> <td>查询给定消息队列的最大offset</td></tr> <tr><td>long</td> <td>minOffset(MessageQueue mq)</td> <td>查询给定消息队列的最小offset</td></tr> <tr><td>QueryResult</td> <td>queryMessage(String topic, String key, int maxNum, long begin, long end)</td> <td>按关键字查询消息</td></tr> <tr><td>long</td> <td>searchOffset(MessageQueue mq, long timestamp)</td> <td>查找指定时间的消息队列的物理offset</td></tr> <tr><td>MessageExt</td> <td>viewMessage(String offsetMsgId)</td> <td>根据给定的msgId查询消息</td></tr> <tr><td>MessageExt</td> <td>public MessageExt viewMessage(String topic, String msgId)</td> <td>根据给定的msgId查询消息，并指定topic</td></tr> <tr><td>MQConsumer接口method</td> <td>-------</td> <td>------------</td></tr> <tr><td>Set</td> <td>fetchSubscribeMessageQueues(String topic)</td> <td>根据topic获取订阅的Queue</td></tr> <tr><td>void</td> <td>sendMessageBack(final MessageExt msg, final int delayLevel)</td> <td>如果消息出来失败，可以发送回去延迟消费，delayLevel=DelayConf.DELAY_LEVEL</td></tr> <tr><td>void</td> <td>sendMessageBack(final MessageExt msg, final int delayLevel, final String brokerName)</td> <td>如果消息出来失败，可以发送回去延迟消费，delayLevel=DelayConf.DELAY_LEVEL</td></tr> <tr><td>MQPullConsumer接口method</td> <td>-------</td> <td>------------</td></tr> <tr><td>long</td> <td>fetchConsumeOffset(MessageQueue mq, boolean fromStore)</td> <td>查询给定消息队列的最大offset</td></tr> <tr><td>PullResult</td> <td>pull(final MessageQueue mq, final String subExpression, final long offset,final int maxNums)</td> <td>异步拉取制定匹配的消息</td></tr> <tr><td>PullResult</td> <td>pull(final MessageQueue mq, final String subExpression, final long offset,final int maxNums, final long timeout)</td> <td>异步拉取制定匹配的消息</td></tr> <tr><td>PullResult</td> <td>pull(final MessageQueue mq, final MessageSelector selector, final long offset,final int maxNums)</td> <td>异步拉取制定匹配的消息，通过MessageSelector器来过滤消息，参考org.apache.rocketmq.common.filter.ExpressionType</td></tr> <tr><td>PullResult</td> <td>pullBlockIfNotFound(final MessageQueue mq, final String subExpression,final long offset, final int maxNums)</td> <td>异步拉取制定匹配的消息，如果没有消息讲block住，并指定超时时间consumerPullTimeoutMillis</td></tr> <tr><td>void</td> <td>pullBlockIfNotFound(final MessageQueue mq, final String subExpression, final long offset,final int maxNums, final PullCallback pullCallback)</td> <td>异步拉取制定匹配的消息，如果没有消息讲block住，并指定超时时间consumerPullTimeoutMillis，通过回调pullCallback来消费</td></tr> <tr><td>void</td> <td>updateConsumeOffset(final MessageQueue mq, final long offset)</td> <td>更新指定mq的offset</td></tr> <tr><td>long</td> <td>fetchMessageQueuesInBalance(String topic)</td> <td>根据topic获取订阅的Queue(是balance分配后的)</td></tr> <tr><td>void</td> <td>void sendMessageBack(MessageExt msg, int delayLevel, String brokerName, String consumerGroup)</td> <td>如果消息出来失败，可以发送回去延迟消费，delayLevel=DelayConf.DELAY_LEVEL,消息可能在同一个consumerGroup消费</td></tr> <tr><td>void</td> <td>shutdown()</td> <td>关闭当前消费者实例并释放相关资源</td></tr> <tr><td>void</td> <td>start()</td> <td>启动消费者</td></tr></tbody></table></div></section> <footer class="page-edit"><div class="edit-link"><a href="http://gitlab.ximalaya.com/business/business-gateway-open-doc/edit/task/update_doc_20220322_181890/docs/message-queue/rocketmq/client/java/API_Reference_DefaultPullConsumer.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">8/16/2022, 9:13:18 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70e916a0><li class="level-2" data-v-70e916a0><a href="/message-queue/rocketmq/client/java/API_Reference_DefaultPullConsumer.html#类简介" class="sidebar-link reco-side-类简介" data-v-70e916a0>类简介</a></li><li class="level-2" data-v-70e916a0><a href="/message-queue/rocketmq/client/java/API_Reference_DefaultPullConsumer.html#字段摘要" class="sidebar-link reco-side-字段摘要" data-v-70e916a0>字段摘要</a></li><li class="level-2" data-v-70e916a0><a href="/message-queue/rocketmq/client/java/API_Reference_DefaultPullConsumer.html#构造方法摘要" class="sidebar-link reco-side-构造方法摘要" data-v-70e916a0>构造方法摘要</a></li><li class="level-2" data-v-70e916a0><a href="/message-queue/rocketmq/client/java/API_Reference_DefaultPullConsumer.html#使用方法摘要" class="sidebar-link reco-side-使用方法摘要" data-v-70e916a0>使用方法摘要</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.9c8caac1.js" defer></script><script src="/assets/js/4.842ec080.js" defer></script><script src="/assets/js/1.792b16dc.js" defer></script><script src="/assets/js/34.11e107ed.js" defer></script>
  </body>
</html>
